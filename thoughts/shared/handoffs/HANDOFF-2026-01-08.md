# Virtual Cofounder - Handoff Document
> **Date**: January 8, 2026  
> **Purpose**: Enable a new chat session to complete the spec implementation

---

## Quick Answer: Agent SDK vs Wrapper

### Current Status: **REAL SDK INSTALLED, NOT ENABLED**

```
Package installed:    @anthropic-ai/claude-agent-sdk ^0.2.1 âœ…
SDK runner written:   lib/agents/sdk-runner.ts âœ…
Imports real SDK:     query() from @anthropic-ai/claude-agent-sdk âœ…
Feature flag set:     AGENT_SDK_ENABLED = false on Vercel âŒ
```

**What this means:**
- The actual `@anthropic-ai/claude-agent-sdk` package IS installed
- The `sdk-runner.ts` file imports and uses the real `query()` function from the SDK
- BUT the feature flag `AGENT_SDK_ENABLED` is **not enabled on production**
- So it currently falls back to `runAgentLegacy()` which uses standard `@anthropic-ai/sdk` (single API call, no tools)

**To enable the real SDK:**
```bash
npx vercel env add AGENT_SDK_ENABLED true --production
```

---

## What Is Implemented (Live on Production)

### âœ… UI Screens (All match mockups)
| Screen | Route | Status |
|--------|-------|--------|
| Dashboard | `/dashboard` | âœ… Live, matches mockup |
| Priorities | `/priorities` | âœ… Live, matches mockup |
| Progress | `/progress` | âœ… Live, matches mockup |
| Projects | `/projects` | âœ… Live, matches mockup |
| Agents | `/agents` | âœ… Live, matches mockup |
| Scans | `/scans` | âœ… Live, matches mockup |
| Gallery | `/gallery` | âœ… Live, matches mockup |
| History | `/history` | âœ… Live, matches mockup |
| Settings | `/settings` | âœ… Live, matches mockup |
| Landing | `/` | âœ… Live |
| Project Detail | `/projects/[id]` | âœ… Live |

### âœ… Database Tables (All created)
| Table | Purpose | Status |
|-------|---------|--------|
| Workspace | Multi-tenant container | âœ… Exists |
| User | User accounts | âœ… Exists |
| Project | Projects being managed | âœ… Exists |
| Scan | Individual scan results | âœ… Exists |
| Story | Work items/user stories | âœ… Exists |
| OrchestratorRun | Orchestrator execution history | âœ… Exists |
| **ProjectSnapshot** | Daily project state blob | âœ… Exists |
| **SlackInbound** | All incoming Slack messages | âœ… Exists |
| **PrioritySignal** | P0-P3 signals from any source | âœ… Exists |
| **AgentSession** | Agent execution sessions | âœ… Exists |
| **AgentOutput** | Non-code agent outputs | âœ… Exists |

### âœ… API Routes (All dynamic, no build timeouts)
All 21 API routes have `export const dynamic = 'force-dynamic'` to prevent static generation timeouts.

### âœ… Backend Code
| Component | File | Status |
|-----------|------|--------|
| Agent Registry | `lib/agents/index.ts` | âœ… 17 agents defined |
| SDK Runner | `lib/agents/sdk-runner.ts` | âœ… Uses real SDK |
| State Aggregation | `lib/state/aggregate.ts` | âœ… Implemented |
| State Manager Agent | `lib/agents/state-manager.ts` | âœ… Defined |
| Priority Classifier | `lib/priority/classifier.ts` | âœ… P0-P3 classification |
| Stack Ranker | `lib/priority/stack-ranker.ts` | âœ… Priority scoring |
| Execution Queue | `lib/queue/execution.ts` | âœ… BullMQ integration |
| Feature Flags | `lib/config/feature-flags.ts` | âœ… 7 flags defined |

---

## What Is NOT Enabled/Tested

### âŒ Feature Flags (NOT set on Vercel)
```
AGENT_SDK_ENABLED=true        # NOT SET - agents run in legacy mode
STATE_AGENT_ENABLED=true      # NOT SET - no project snapshots
MULTI_SOURCE_APPROVAL=true    # NOT SET - only Slack approval
LAUNCH_READINESS=true         # NOT SET - Progress page may be limited
PRIORITY_SYSTEM_ENABLED=true  # NOT SET - legacy priority
PARALLEL_EXECUTION_ENABLED=true  # NOT SET - sequential only
```

### âŒ E2E Flows (NOT tested)
1. **Scan â†’ Story Flow**: Trigger scan, check stories created
2. **Approval â†’ Execution**: Approve story, verify it runs
3. **PR Creation**: Code agent creates real PR (not placeholder)
4. **Linear Integration**: Status changes trigger queue
5. **Slack Integration**: Bot responds, captures signals
6. **Project Snapshots**: State agent creates daily snapshots

### âŒ Workers (May need deployment verification)
| Worker | Purpose | Status |
|--------|---------|--------|
| `workers/orchestrator-worker.ts` | Runs orchestrator | âš ï¸ Not verified |
| `workers/execution-worker.ts` | Executes approved stories | âš ï¸ Not verified |
| `workers/scan-worker.ts` | Processes scan jobs | âš ï¸ Not verified |

---

## Spec vs Live Comparison

### From MASTER-SPEC.md:

| Spec Requirement | Implementation Status |
|------------------|----------------------|
| Multi-turn agents with tools | ğŸŸ¡ Code ready, flag disabled |
| Real code changes via Agent SDK | ğŸŸ¡ Code ready, flag disabled |
| Auto-enqueue on approval (Linear, Slack, Dashboard) | âœ… Code written |
| Project state snapshots | ğŸŸ¡ Code ready, flag disabled |
| P0-P3 priority system | ğŸŸ¡ Code ready, flag disabled |
| Stack-ranked priority lists | âœ… UI and API done |
| Launch readiness score | âœ… UI and logic done |
| Gallery for non-code outputs | âœ… UI and API done |
| 17 specialist agents defined | âœ… In agent registry |
| Thinking traces stored | ğŸŸ¡ Schema ready, needs execution |

### Legend:
- âœ… Fully implemented and live
- ğŸŸ¡ Code implemented but needs feature flag enabled or E2E testing
- âŒ Not implemented

---

## Files to Reference

### Core Spec Files
```
/explorations/final-spec/
â”œâ”€â”€ MASTER-SPEC.md          # Complete system specification
â”œâ”€â”€ IMPLEMENTATION-PLAN.md   # Phase-by-phase task breakdown
â”œâ”€â”€ mockups.html            # All UI mockups (source of truth for design)
â”œâ”€â”€ architecture.html       # System architecture diagrams
â”œâ”€â”€ prd-impl.json           # 47 user stories in JSON
â””â”€â”€ ralph-impl.sh           # Automated story runner
```

### Key Implementation Files
```
/lib/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ index.ts            # 17 agent definitions
â”‚   â”œâ”€â”€ sdk-runner.ts       # Real Agent SDK integration
â”‚   â””â”€â”€ state-manager.ts    # State aggregation agent
â”œâ”€â”€ priority/
â”‚   â”œâ”€â”€ classifier.ts       # P0-P3 signal classification
â”‚   â””â”€â”€ stack-ranker.ts     # Priority scoring algorithm
â”œâ”€â”€ state/
â”‚   â””â”€â”€ aggregate.ts        # Project state aggregation
â”œâ”€â”€ config/
â”‚   â””â”€â”€ feature-flags.ts    # 7 feature flags
â””â”€â”€ queue/
    â””â”€â”€ execution.ts        # BullMQ job enqueue
```

---

## Next Steps for New Chat

### Priority 1: Enable Feature Flags
```bash
# Enable all feature flags on Vercel
npx vercel env add AGENT_SDK_ENABLED true
npx vercel env add STATE_AGENT_ENABLED true
npx vercel env add MULTI_SOURCE_APPROVAL true
npx vercel env add LAUNCH_READINESS true
npx vercel env add PRIORITY_SYSTEM_ENABLED true
```

### Priority 2: E2E Testing
Test the full flow end-to-end:

1. **Trigger a scan manually**
   ```bash
   curl -X POST https://virtualcofounder.ai/api/scans/trigger
   ```

2. **Check stories were created**
   - Visit `/priorities` to see new stories
   - Should have P0-P3 priorities assigned

3. **Approve a story**
   - Click "Approve" on a story
   - Or use Slack to approve
   - Or change Linear status to "In Progress"

4. **Verify execution**
   - Check Railway worker logs
   - Verify PR created on GitHub
   - Check Linear task updated

5. **Test Slack bot**
   - Send DM to bot
   - Check `/history` for logged messages
   - Verify priority signals created

### Priority 3: Documentation (Task 5.9)
- Update README.md with:
  - Getting started guide
  - Environment variables list
  - Feature flag explanations
  - Architecture overview

### Priority 4: Demo Video (Task 5.10)
- Record 3-5 minute walkthrough showing:
  - Dashboard overview
  - Triggering a scan
  - Approving work
  - Viewing agent activity
  - Checking PR output

---

## Known Issues / Blockers

1. **No data in production** - Most pages show "0" or "No items" because:
   - No scans have been triggered
   - No stories exist
   - No agent sessions have run

2. **Workers may not be running** - Railway deployments need verification

3. **Slack bot may need reconnection** - Test bot responsiveness

4. **Linear webhook may need verification** - Test status change flow

---

## Environment Variables Reference

### Required on Vercel (already set):
```
DATABASE_URL          # Supabase PostgreSQL
ANTHROPIC_API_KEY     # Claude API
REDIS_URL             # BullMQ queue
SLACK_BOT_TOKEN       # Slack bot
SLACK_SIGNING_SECRET  # Slack events
LINEAR_API_KEY        # Linear integration
WORKSPACE_ID          # Default workspace
```

### Feature Flags to Add:
```
AGENT_SDK_ENABLED=true
STATE_AGENT_ENABLED=true
MULTI_SOURCE_APPROVAL=true
LAUNCH_READINESS=true
PRIORITY_SYSTEM_ENABLED=true
PARALLEL_EXECUTION_ENABLED=false  # Keep false for safety
NATIVE_CHAT_ENABLED=false         # Not implemented
```

---

## Summary

| Category | Status |
|----------|--------|
| UI Screens | âœ… Complete, matches mockups |
| Database Schema | âœ… Complete, all tables exist |
| API Routes | âœ… Complete, all dynamic |
| Agent SDK Code | âœ… Written, uses real SDK |
| Feature Flags | âŒ Not enabled on production |
| E2E Testing | âŒ Not done |
| Worker Verification | âŒ Not done |
| Documentation | âŒ Task 5.9 not done |
| Demo Video | âŒ Task 5.10 not done |

**Bottom Line**: The code is written and ready. The next steps are:
1. Enable feature flags
2. Run E2E tests
3. Fix any issues that arise
4. Write documentation
